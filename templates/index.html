<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PikPak 注册助手</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="icon" href="../static/icon.png" />
  </head>
  <body>
    <div id="app" class="app-container" v-cloak>
      <div class="container">
        <div class="header text-center mb-4">
          <h1 class="display-4">
            <i class="bi bi-cloud-arrow-up-fill text-primary"></i> PikPak
            注册助手
          </h1>
          <p class="lead">请不要使用临时邮箱作为被邀账号</p>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs nav-fill mb-4">
          <li class="nav-item">
            <a
              class="nav-link"
              :class="{ 'active': activeTab === 'register' }"
              href="#"
              @click.prevent="activeTab = 'register'"
            >
              <i class="bi bi-person-plus-fill"></i> 注册账号
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              :class="{ 'active': activeTab === 'extract' }"
              href="#"
              @click.prevent="activeTab = 'extract'"
            >
              <i class="bi bi-envelope-exclamation-fill"></i> 提取验证码
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              :class="{ 'active': activeTab === 'history' }"
              href="#"
              @click.prevent="showAccountHistory"
            >
              <i class="bi bi-clock-history"></i> 历史账号
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              :class="{ 'active': activeTab === 'activate' }"
              href="#"
              @click.prevent="showActivationTab"
            >
              <i class="bi bi-lightning-charge-fill"></i> 账号一键活跃
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              :class="{ 'active': activeTab === 'email_extraction' }"
              href="#"
              @click.prevent="activeTab = 'email_extraction'"
            >
              <i class="bi bi-envelope-fill"></i> 邮箱提取
            </a>
          </li>
        </ul>

        <!-- Registration Tab -->
        <div v-if="activeTab === 'register'">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="card shadow-lg">
                <div class="card-body p-4">
                  <!-- Progress Bar -->
                  <div class="progress-container mb-4">
                    <ul class="stepper">
                      <li
                        class="step"
                        :class="{ 'active': currentStep >= 1, 'complete': currentStep > 1 }"
                      >
                        <div class="step-circle">1</div>
                        <div class="step-label">配置</div>
                      </li>
                      <li
                        class="step"
                        :class="{ 'active': currentStep >= 2, 'complete': currentStep > 2 }"
                      >
                        <div class="step-circle">2</div>
                        <div class="step-label">验证</div>
                      </li>
                      <li
                        class="step"
                        :class="{ 'active': currentStep >= 3, 'complete': currentStep > 3 }"
                      >
                        <div class="step-circle">3</div>
                        <div class="step-label">注册</div>
                      </li>
                      <li class="step" :class="{ 'active': currentStep >= 4 }">
                        <div class="step-circle">4</div>
                        <div class="step-label">完成</div>
                      </li>
                    </ul>
                    <div class="progress">
                      <div
                        class="progress-bar bg-primary"
                        role="progressbar"
                        :style="{ width: progressPercent + '%' }"
                      ></div>
                    </div>
                  </div>

                  <!-- Step 1: Configuration -->
                  <div v-if="currentStep === 1" class="step-content">
                    <h3 class="card-title mb-4">
                      <i class="bi bi-gear-fill text-primary"></i> 配置
                    </h3>

                    <div class="form-floating mb-3">
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        placeholder="name@example.com"
                        v-model="email"
                        required
                      />
                      <label for="email">邮箱地址</label>
                    </div>

                    <div class="form-floating mb-3">
                      <input
                        type="text"
                        class="form-control"
                        id="inviteCode"
                        placeholder="邀请码"
                        v-model="inviteCode"
                        required
                      />
                      <label for="inviteCode">邀请码</label>
                    </div>

                    <div class="form-check form-switch mb-3">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="useProxy"
                        v-model="useProxy"
                      />
                      <label class="form-check-label" for="useProxy"
                        >使用代理</label
                      >
                    </div>

                    <div
                      v-if="useProxy"
                      class="proxy-settings mb-3 animate__animated animate__fadeIn"
                    >
                      <div class="form-floating mb-2">
                        <input
                          type="text"
                          class="form-control"
                          id="proxyUrl"
                          placeholder="http://127.0.0.1:7890"
                          v-model="proxyUrl"
                        />
                        <label for="proxyUrl">代理地址</label>
                      </div>
                      <div class="d-grid">
                        <button
                          @click="testProxy"
                          class="btn btn-outline-primary"
                          :disabled="isTestingProxy"
                        >
                          <span v-if="isTestingProxy">
                            <span
                              class="spinner-border spinner-border-sm"
                              role="status"
                              aria-hidden="true"
                            ></span>
                            测试中...
                          </span>
                          <span v-else>
                            <i class="bi bi-speedometer"></i> 测试代理连接
                          </span>
                        </button>
                      </div>
                      <div
                        v-if="proxyTestResult !== null"
                        class="mt-2 alert"
                        :class="proxyTestResult ? 'alert-success' : 'alert-danger'"
                      >
                        <i
                          :class="proxyTestResult ? 'bi bi-check-circle-fill' : 'bi bi-exclamation-circle-fill'"
                        ></i>
                        <span v-if="proxyTestResult">代理连接测试成功</span>
                        <span v-else>代理连接测试失败</span>
                      </div>
                    </div>

                    <div class="d-grid mt-4">
                      <button
                        @click="initialize"
                        class="btn btn-primary btn-lg"
                        :disabled="isInitializing || !email || !inviteCode"
                      >
                        <span v-if="isInitializing">
                          <span
                            class="spinner-border spinner-border-sm"
                            role="status"
                            aria-hidden="true"
                          ></span>
                          初始化中...
                        </span>
                        <span v-else>
                          <i class="bi bi-arrow-right-circle-fill"></i> 开始注册
                        </span>
                      </button>
                    </div>
                  </div>

                  <!-- Step 2: Verification -->
                  <div v-if="currentStep === 2" class="step-content">
                    <h3 class="card-title mb-4">
                      <i class="bi bi-shield-lock-fill text-primary"></i> 验证
                    </h3>

                    <div class="text-center mb-4">
                      <div class="verification-status">
                        <div v-if="isVerifying" class="verification-spinner">
                          <div
                            class="spinner-border text-primary"
                            role="status"
                          >
                            <span class="visually-hidden">验证中...</span>
                          </div>
                          <p class="mt-2">正在自动完成滑块验证，请稍候...</p>
                        </div>
                        <div
                          v-else-if="verificationSuccess"
                          class="verification-success"
                        >
                          <i
                            class="bi bi-check-circle-fill text-success verification-icon"
                          ></i>
                          <p class="mt-2">
                            滑块验证成功! 验证码已发送到您的邮箱。
                          </p>
                        </div>
                        <div v-else class="verification-retry">
                          <i
                            class="bi bi-exclamation-circle-fill text-warning verification-icon"
                          ></i>
                          <p class="mt-2">滑块验证失败，请重试。</p>
                        </div>
                      </div>
                    </div>

                    <div class="device-info mb-4">
                      <div class="row g-2">
                        <div class="col-md-6">
                          <div class="info-card">
                            <i class="bi bi-cpu-fill text-primary"></i>
                            <p>
                              <strong>设备 ID:</strong>
                              <span v-text="deviceId"></span>
                            </p>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="info-card">
                            <i class="bi bi-tag-fill text-primary"></i>
                            <p>
                              <strong>版本:</strong>
                              <span v-text="version"></span>
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="d-grid gap-2">
                      <button
                        @click="verifyCaptcha"
                        class="btn btn-primary btn-lg"
                        :disabled="isVerifying || verificationSuccess"
                      >
                        <span v-if="isVerifying">
                          <span
                            class="spinner-border spinner-border-sm"
                            role="status"
                            aria-hidden="true"
                          ></span>
                          验证中...
                        </span>
                        <span v-else>
                          <i class="bi bi-arrow-repeat"></i>
                          <span v-if="verificationSuccess">重新验证</span>
                          <span v-else>开始滑块验证</span>
                        </span>
                      </button>

                      <button
                        v-if="verificationSuccess"
                        @click="goToNextStep"
                        class="btn btn-success btn-lg"
                      >
                        <i class="bi bi-arrow-right-circle-fill"></i> 继续
                      </button>

                      <button
                        @click="goToPreviousStep"
                        class="btn btn-outline-secondary mt-2"
                      >
                        <i class="bi bi-arrow-left"></i> 返回
                      </button>
                    </div>
                  </div>

                  <!-- Step 3: Registration -->
                  <div v-if="currentStep === 3" class="step-content">
                    <h3 class="card-title mb-4">
                      <i class="bi bi-person-plus-fill text-primary"></i> 注册
                    </h3>

                    <div class="alert alert-info mb-4">
                      <i class="bi bi-info-circle-fill"></i>
                      验证码已发送到
                      <strong><span v-text="email"></span></strong
                      >，请检查您的邮箱。
                    </div>

                    <div class="form-floating mb-4">
                      <input
                        type="text"
                        class="form-control"
                        id="verificationCode"
                        placeholder="验证码"
                        v-model="verificationCode"
                        required
                      />
                      <label for="verificationCode">邮箱验证码</label>
                    </div>

                    <div class="d-grid gap-2">
                      <button
                        @click="register"
                        class="btn btn-primary btn-lg"
                        :disabled="isRegistering || !verificationCode"
                      >
                        <span v-if="isRegistering">
                          <span
                            class="spinner-border spinner-border-sm"
                            role="status"
                            aria-hidden="true"
                          ></span>
                          注册中...
                        </span>
                        <span v-else>
                          <i class="bi bi-check-circle-fill"></i> 完成注册
                        </span>
                      </button>

                      <button
                        @click="goToPreviousStep"
                        class="btn btn-outline-secondary"
                        :disabled="isRegistering"
                      >
                        <i class="bi bi-arrow-left"></i> 返回
                      </button>
                    </div>
                  </div>

                  <!-- Step 4: Completion -->
                  <div v-if="currentStep === 4" class="step-content">
                    <div class="text-center mb-4">
                      <i
                        class="bi bi-check-circle-fill text-success completion-icon"
                      ></i>
                      <h3 class="card-title mt-3">注册成功!</h3>
                      <p class="lead">
                        您的 PikPak 账号已成功创建，邀请码已激活。
                      </p>
                    </div>

                    <div class="account-info mb-4">
                      <div class="card">
                        <div class="card-header bg-primary text-white">
                          <h5 class="mb-0">
                            <i class="bi bi-key-fill"></i> 账号信息
                          </h5>
                        </div>
                        <div class="card-body">
                          <pre
                            class="account-json"
                            v-text="JSON.stringify(accountInfo, null, 2)"
                          ></pre>
                        </div>
                      </div>
                    </div>

                    <div class="d-grid gap-2">
                      <button
                        @click="copyAccountInfo"
                        class="btn btn-outline-primary btn-lg"
                      >
                        <i class="bi bi-clipboard"></i> 复制账号信息
                      </button>

                      <button @click="resetApp" class="btn btn-success btn-lg">
                        <i class="bi bi-plus-circle-fill"></i> 注册新账号
                      </button>
                    </div>
                  </div>

                  <!-- Alert Messages -->
                  <div
                    v-if="alertMessage"
                    class="alert mt-4"
                    :class="'alert-' + alertType"
                    role="alert"
                  >
                    <i
                      :class="'bi bi-' + (alertType === 'success' ? 'check-circle-fill' : 'exclamation-circle-fill')"
                    ></i>
                    <span v-text="alertMessage"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Extract Verification Code Tab -->
        <div v-if="activeTab === 'extract'">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="card shadow-lg">
                <div class="card-body p-4">
                  <h3 class="card-title mb-4">
                    <i class="bi bi-envelope-exclamation-fill text-primary"></i>
                    适用于闪邮箱
                  </h3>

                  <div class="form-floating mb-3">
                    <textarea
                      class="form-control"
                      id="sourceData"
                      placeholder="请输入源数据"
                      v-model="sourceData"
                      style="height: 100px"
                      @input="clearSourceDataLabel"
                    ></textarea>
                    <label for="sourceData" v-if="!sourceData"
                      >源数据</label
                    >
                  </div>

                  <div class="row g-3 mb-3">
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="email"
                          class="form-control"
                          id="extractEmail"
                          placeholder="邮箱"
                          v-model="extractEmail"
                          readonly
                        />
                        <label for="extractEmail">邮箱</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          id="extractPassword"
                          placeholder="密码"
                          v-model="extractPassword"
                          readonly
                        />
                        <label for="extractPassword">密码</label>
                      </div>
                    </div>
                  </div>

                  <div class="d-grid gap-2">
                    <button
                      @click="parseSourceData"
                      class="btn btn-outline-primary"
                    >
                      <i class="bi bi-arrow-down-circle"></i> 解析数据
                    </button>
                    <button
                      @click="fetchVerificationCode"
                      class="btn btn-primary"
                      :disabled="isFetchingCode || !extractEmail || !extractPassword"
                    >
                      <span v-if="isFetchingCode">
                        <span
                          class="spinner-border spinner-border-sm"
                          role="status"
                          aria-hidden="true"
                        ></span>
                        获取中...
                      </span>
                      <span v-else>
                        <i class="bi bi-envelope-paper-fill"></i> 获取验证码
                      </span>
                    </button>
                  </div>

                  <!-- Result Box -->
                  <div v-if="verificationResult" class="mt-4">
                    <div class="card">
                      <div
                        class="card-header"
                        :class="verificationResult.code === 200 ? 'bg-success text-white' : 'bg-danger text-white'"
                      >
                        <h5 class="mb-0">
                          <i
                            :class="verificationResult.code === 200 ? 'bi bi-check-circle-fill' : 'bi bi-exclamation-circle-fill'"
                          ></i>
                          {% raw %}{{ verificationResult.code === 200 ?
                          '验证码获取成功' : '验证码获取失败' }}{% endraw %}
                        </h5>
                      </div>
                      <div class="card-body">
                        <div
                          v-if="verificationResult.code === 200"
                          class="verification-success-box"
                        >
                          <h2 class="text-center verification-code mb-3">
                            {% raw %}{{ verificationResult.verification_code
                            }}{% endraw %}
                          </h2>
                        </div>
                        <div v-else class="alert alert-danger">
                          <p class="mb-0">
                            <strong>错误:</strong> {% raw %}{{
                            verificationResult.msg }}{% endraw %}
                          </p>
                        </div>

                        <div
                          class="d-grid mt-3"
                          v-if="verificationResult.code === 200"
                        >
                          <button
                            @click="copyVerificationCode"
                            class="btn btn-outline-success"
                          >
                            <i class="bi bi-clipboard"></i> 复制验证码
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Alert Messages -->
                  <div
                    v-if="alertMessage"
                    class="alert mt-4"
                    :class="'alert-' + alertType"
                    role="alert"
                  >
                    <i
                      :class="'bi bi-' + (alertType === 'success' ? 'check-circle-fill' : 'exclamation-circle-fill')"
                    ></i>
                    <span v-text="alertMessage"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Account History Tab -->
        <div v-if="activeTab === 'history'">
          <div class="row justify-content-center">
            <div class="col-lg-10">
              <div class="card shadow-lg">
                <div class="card-body p-4">
                  <h3 class="card-title mb-4">
                    <i class="bi bi-clock-history text-primary"></i> 历史账号
                    <button
                      @click="fetchAccounts"
                      class="btn btn-outline-primary btn-sm float-end"
                    >
                      <i class="bi bi-arrow-clockwise"></i> 刷新
                    </button>
                  </h3>

                  <div v-if="isLoadingAccounts" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">加载中...</span>
                    </div>
                    <p class="mt-2">加载账号列表中...</p>
                  </div>

                  <div
                    v-else-if="accounts.length === 0"
                    class="text-center py-5"
                  >
                    <i class="bi bi-inbox text-muted empty-icon"></i>
                    <p class="lead mt-3">没有找到历史账号</p>
                    <button
                      @click="activeTab = 'register'"
                      class="btn btn-primary mt-2"
                    >
                      <i class="bi bi-plus-circle"></i> 创建新账号
                    </button>
                  </div>

                  <div v-else class="table-responsive">
                    <table class="table table-hover">
                      <thead class="table-light">
                        <tr>
                          <th>邮箱</th>
                          <th>用户名</th>
                          <th>设备ID</th>
                          <th>版本</th>
                          <th>操作</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr v-for="(account, index) in accounts" :key="index">
                          <td>
                            <span v-text="account.email || '未知'"></span>
                          </td>
                          <td><span v-text="account.name || '未知'"></span></td>
                          <td class="text-truncate" style="max-width: 150px">
                            <span v-text="account.device_id || '未知'"></span>
                          </td>
                          <td>
                            <span v-text="account.version || '未知'"></span>
                          </td>
                          <td>
                            <div class="btn-group btn-group-sm" role="group">
                              <button
                                @click="viewAccount(account)"
                                class="btn btn-outline-primary"
                              >
                                <i class="bi bi-eye"></i>
                              </button>
                              <button
                                @click="editAccount(account)"
                                class="btn btn-outline-secondary"
                              >
                                <i class="bi bi-pencil"></i>
                              </button>
                              <button
                                @click="confirmDeleteAccount(account)"
                                class="btn btn-outline-danger"
                              >
                                <i class="bi bi-trash"></i>
                              </button>
                            </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Account Activation Tab -->
        <div v-if="activeTab === 'activate'">
          <div class="row justify-content-center">
            <div class="col-lg-10">
              <div class="card shadow-lg">
                <div class="card-body p-4">
                  <h3 class="card-title mb-4">
                    <i class="bi bi-lightning-charge-fill text-primary"></i>
                    一键活跃
                  </h3>

                  <div class="mb-4">
                    <div class="alert alert-info">
                      <i class="bi bi-info-circle-fill"></i>
                      对被邀请的账号进行活跃操作，邀请完成后执行一次，次日十点前请再次操作一次<br />
                      <strong>成功活跃后的新账号数据将自动保存。</strong>
                    </div>
                  </div>

                  <!-- Account Selection -->
                  <div class="mb-4">
                    <label for="activationAccount" class="form-label"
                      >选择账号</label
                    >
                    <select
                      class="form-select"
                      id="activationAccount"
                      v-model="activationAccount"
                      :disabled="isLoadingAccounts || isActivating"
                    >
                      <option value="" selected disabled>请选择一个账号</option>
                      <option
                        v-for="(account, index) in accounts"
                        :key="index"
                        :value="account"
                      >
                        {% raw %}{{ account.email || '未知邮箱' }} ({{
                        account.name || '未知用户名' }}){% endraw %}
                      </option>
                    </select>
                    <div class="mt-2" v-if="activationAccount">
                      <div class="card bg-light">
                        <div class="card-body">
                          <p class="mb-2">
                            <strong>邮箱:</strong> {% raw %}{{
                            activationAccount.email || '未知' }}{% endraw %}
                          </p>
                          <p class="mb-2">
                            <strong>用户名:</strong> {% raw %}{{
                            activationAccount.name || '未知' }}{% endraw %}
                          </p>
                          <p class="mb-0">
                            <strong>设备ID:</strong> {% raw %}{{
                            activationAccount.device_id || '未知' }}{% endraw %}
                          </p>
                        </div>
                      </div>
                    </div>
                    <button
                      class="btn btn-outline-primary mt-2"
                      @click="fetchAccounts"
                      :disabled="isLoadingAccounts || isActivating"
                    >
                      <i class="bi bi-arrow-clockwise"></i> 刷新账号列表
                    </button>
                  </div>

                  <!-- Secret Key Input -->
                  <div class="mb-4">
                    <label for="activationKey" class="form-label"
                      >密钥：<a href="https://kiteyuan.info/" target="_blank"
                        >获取</a
                      ></label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="activationKey"
                      v-model="activationKey"
                      placeholder="请输入密钥"
                      :disabled="isActivating"
                    />
                  </div>

                  <!-- Activate Button -->
                  <div class="d-grid gap-2">
                    <button
                      @click="activateAccount"
                      class="btn btn-primary btn-lg"
                      :disabled="!activationAccount || !activationKey || isActivating"
                    >
                      <span v-if="isActivating">
                        <span
                          class="spinner-border spinner-border-sm"
                          role="status"
                          aria-hidden="true"
                        ></span>
                        操作中...
                      </span>
                      <span v-else>
                        <i class="bi bi-lightning-charge-fill"></i> 立即执行
                      </span>
                    </button>
                  </div>

                  <!-- Activation Result -->
                  <div v-if="activationResult" class="mt-4">
                    <div class="card">
                      <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                          <i class="bi bi-check-circle-fill"></i> 执行结果
                          <span
                            v-if="activationResult.code === 200"
                            class="badge bg-success float-end"
                            >已自动更新账号数据</span
                          >
                        </h5>
                      </div>
                      <div class="card-body">
                        <div
                          v-if="activationResult.code === 200"
                          class="alert alert-success mb-3"
                        >
                          <i class="bi bi-info-circle-fill"></i>
                          {% raw %}{{ activationResult.msg }}{% endraw %}
                        </div>
                        <pre class="activation-result">
{% raw %}{{ JSON.stringify(activationResult, null, 2) }}{% endraw %}</pre
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Alert Messages -->
                  <div
                    v-if="alertMessage"
                    class="alert mt-4"
                    :class="'alert-' + alertType"
                    role="alert"
                  >
                    <i
                      :class="'bi bi-' + (alertType === 'success' ? 'check-circle-fill' : 'exclamation-circle-fill')"
                    ></i>
                    <span v-text="alertMessage"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Account View Modal -->
        <div
          class="modal fade"
          id="accountViewModal"
          tabindex="-1"
          aria-labelledby="accountViewModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="accountViewModalLabel">账号详情</h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div v-if="selectedAccount">
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <p>
                        <strong>邮箱:</strong>
                        <span v-text="selectedAccount.email || '未知'"></span>
                      </p>
                      <p>
                        <strong>用户名:</strong>
                        <span v-text="selectedAccount.name || '未知'"></span>
                      </p>
                      <p>
                        <strong>密码:</strong>
                        <span
                          v-text="selectedAccount.password || '未知'"
                        ></span>
                      </p>
                    </div>
                    <div class="col-md-6">
                      <p>
                        <strong>版本:</strong>
                        <span v-text="selectedAccount.version || '未知'"></span>
                      </p>
                      <p>
                        <strong>设备ID:</strong>
                        <span
                          v-text="selectedAccount.device_id || '未知'"
                        ></span>
                      </p>
                      <p>
                        <strong>用户ID:</strong>
                        <span v-text="selectedAccount.user_id || '未知'"></span>
                      </p>
                    </div>
                  </div>
                  <div class="card bg-light">
                    <div class="card-header">完整账号信息</div>
                    <div class="card-body">
                      <pre class="mb-0">
{% raw %}{{ JSON.stringify(selectedAccount, null, 2) }}{% endraw %}</pre
                      >
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button
                  @click="copySelectedAccountInfo"
                  class="btn btn-outline-primary"
                >
                  <i class="bi bi-clipboard"></i> 复制账号信息
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  关闭
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Account Edit Modal -->
        <div
          class="modal fade"
          id="accountEditModal"
          tabindex="-1"
          aria-labelledby="accountEditModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="accountEditModalLabel">编辑账号</h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <div v-if="editingAccount">
                  <ul class="nav nav-tabs" id="editTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link active"
                        id="basic-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#basic-info"
                        type="button"
                        role="tab"
                        aria-controls="basic-info"
                        aria-selected="true"
                      >
                        基本信息
                      </button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link"
                        id="json-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#json-edit"
                        type="button"
                        role="tab"
                        aria-controls="json-edit"
                        aria-selected="false"
                      >
                        完整JSON
                      </button>
                    </li>
                  </ul>
                  <div class="tab-content pt-3" id="editTabsContent">
                    <div
                      class="tab-pane fade show active"
                      id="basic-info"
                      role="tabpanel"
                      aria-labelledby="basic-tab"
                    >
                      <div class="mb-3">
                        <label for="editEmail" class="form-label">邮箱</label>
                        <input
                          type="email"
                          class="form-control"
                          id="editEmail"
                          v-model="editingAccount.email"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="editName" class="form-label">用户名</label>
                        <input
                          type="text"
                          class="form-control"
                          id="editName"
                          v-model="editingAccount.name"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="editPassword" class="form-label"
                          >密码</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="editPassword"
                          v-model="editingAccount.password"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="editDeviceId" class="form-label"
                          >设备ID</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="editDeviceId"
                          v-model="editingAccount.device_id"
                        />
                      </div>
                    </div>
                    <div
                      class="tab-pane fade"
                      id="json-edit"
                      role="tabpanel"
                      aria-labelledby="json-tab"
                    >
                      <div class="mb-3">
                        <label for="jsonEditor" class="form-label"
                          >完整JSON数据</label
                        >
                        <div class="alert alert-warning">
                          <i class="bi bi-exclamation-triangle-fill"></i>
                          请确保JSON格式正确，否则可能导致账号无法使用
                        </div>
                        <textarea
                          class="form-control code-editor"
                          id="jsonEditor"
                          rows="15"
                          v-model="jsonEditText"
                          @input="validateJson"
                        ></textarea>
                        <div v-if="jsonError" class="alert alert-danger mt-2">
                          <i class="bi bi-exclamation-circle-fill"></i>
                          JSON格式错误: <span v-text="jsonError"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  取消
                </button>
                <button
                  @click="saveAccount"
                  class="btn btn-primary"
                  :disabled="isSaving || jsonError"
                >
                  <span v-if="isSaving">
                    <span
                      class="spinner-border spinner-border-sm"
                      role="status"
                      aria-hidden="true"
                    ></span>
                    保存中...
                  </span>
                  <span v-else>保存</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div
          class="modal fade"
          id="deleteConfirmModal"
          tabindex="-1"
          aria-labelledby="deleteConfirmModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel">
                  确认删除
                </h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <p>您确定要删除此账号吗？此操作无法撤销。</p>
                <div v-if="accountToDelete" class="alert alert-warning">
                  <p class="mb-0">
                    <strong>邮箱:</strong>
                    <span v-text="accountToDelete.email || '未知'"></span>
                  </p>
                  <p class="mb-0">
                    <strong>用户名:</strong>
                    <span v-text="accountToDelete.name || '未知'"></span>
                  </p>
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  取消
                </button>
                <button
                  @click="deleteAccount"
                  class="btn btn-danger"
                  :disabled="isDeleting"
                >
                  <span v-if="isDeleting">
                    <span
                      class="spinner-border spinner-border-sm"
                      role="status"
                      aria-hidden="true"
                    ></span>
                    删除中...
                  </span>
                  <span v-else>确认删除</span>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Email Extraction Tab -->
        <div v-if="activeTab === 'email_extraction'">
          <div class="row justify-content-center">
            <div class="col-md-8">
              <div class="card shadow-lg">
                <div class="card-body p-4">
                  <h3 class="card-title mb-4">
                    <i class="bi bi-envelope-fill text-primary"></i> 闪邮箱账号提取
                  </h3>

                  <div class="mb-4">
                    <div class="form-floating mb-3">
                      <input
                        type="text"
                        class="form-control"
                        id="apiKey"
                        v-model="apiKey"
                        placeholder="API密钥"
                      />
                      <label for="apiKey">API密钥 (Card)</label>
                    </div>

                    <div class="d-grid">
                      <button
                        @click="checkInventoryAndBalance"
                        class="btn btn-outline-primary mb-3"
                        :disabled="isChecking || !apiKey"
                      >
                        <span v-if="isChecking">
                          <span
                            class="spinner-border spinner-border-sm"
                            role="status"
                            aria-hidden="true"
                          ></span>
                          查询中...
                        </span>
                        <span v-else>
                          <i class="bi bi-arrow-repeat"></i> 刷新状态
                        </span>
                      </button>
                    </div>
                  </div>

                  <!-- Inventory and Balance Info -->
                  <div v-if="inventoryInfo || balanceInfo" class="row mb-4">
                    <div class="col-md-6">
                      <div class="card bg-light mb-3">
                        <div class="card-header bg-primary text-white">
                          <h5 class="mb-0">
                            <i class="bi bi-box-seam"></i> 邮箱库存
                          </h5>
                        </div>
                        <div class="card-body">
                          <ul class="list-group list-group-flush">
                            <li
                              class="list-group-item d-flex justify-content-between align-items-center"
                              v-if="inventoryInfo"
                            >
                              <span>Hotmail</span>
                              <span class="badge bg-primary rounded-pill"
                                >{% raw %}{{ inventoryInfo.hotmail || 0 }}{%
                                endraw %}</span
                              >
                            </li>
                            <li
                              class="list-group-item d-flex justify-content-between align-items-center"
                              v-if="inventoryInfo"
                            >
                              <span>Outlook</span>
                              <span class="badge bg-primary rounded-pill"
                                >{% raw %}{{ inventoryInfo.outlook || 0 }}{%
                                endraw %}</span
                              >
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="card bg-light">
                        <div class="card-header bg-success text-white">
                          <h5 class="mb-0">
                            <i class="bi bi-wallet2"></i> 账户余额
                          </h5>
                        </div>
                        <div class="card-body">
                          <ul class="list-group list-group-flush">
                            <li
                              class="list-group-item d-flex justify-content-between align-items-center"
                            >
                              <span>当前余额</span>
                              <span class="badge bg-success rounded-pill"
                                >{% raw %}{{ balanceInfo || 0 }}{% endraw
                                %}</span
                              >
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Extract Form -->
                  <div class="mb-4">
                    <h5 class="mb-3">
                      <i class="bi bi-envelope-paper-fill text-primary"></i>
                      提取邮箱
                    </h5>

                    <div class="form-group mb-3">
                      <label class="form-label">邮箱类型</label>
                      <div class="d-flex">
                        <div class="form-check me-4">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="emailType"
                            id="typeHotmail"
                            value="hotmail"
                            v-model="emailType"
                          />
                          <label class="form-check-label" for="typeHotmail">
                            Hotmail
                          </label>
                        </div>
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="radio"
                            name="emailType"
                            id="typeOutlook"
                            value="outlook"
                            v-model="emailType"
                          />
                          <label class="form-check-label" for="typeOutlook">
                            Outlook
                          </label>
                        </div>
                      </div>
                    </div>

                    <div class="form-floating mb-3">
                      <input
                        type="number"
                        class="form-control"
                        id="extractCount"
                        v-model="extractCount"
                        placeholder="提取数量"
                        min="1"
                        max="2000"
                      />
                      <label for="extractCount">提取数量 (1-2000)</label>
                    </div>

                    <div class="d-grid">
                      <button
                        @click="extractEmails"
                        class="btn btn-primary"
                        :disabled="isExtracting || !apiKey || !emailType || !extractCount"
                      >
                        <span v-if="isExtracting">
                          <span
                            class="spinner-border spinner-border-sm"
                            role="status"
                            aria-hidden="true"
                          ></span>
                          提取中...
                        </span>
                        <span v-else>
                          <i class="bi bi-envelope-fill"></i> 提取邮箱
                        </span>
                      </button>
                    </div>
                  </div>

                  <!-- Extract Results -->
                  <div v-if="extractedEmails.length > 0" class="mt-4">
                    <div class="card">
                      <div
                        class="card-header bg-success text-white d-flex justify-content-between align-items-center"
                      >
                        <h5 class="mb-0">
                          <i class="bi bi-check-circle-fill"></i> 提取成功
                        </h5>
                        <span class="badge bg-light text-dark">
                          总计: {% raw %}{{ extractedEmails.length }}{% endraw
                          %} 个邮箱
                        </span>
                      </div>
                      <div class="card-body">
                        <div class="mb-3 d-grid">
                          <button
                            @click="copyExtractedEmails"
                            class="btn btn-outline-primary"
                          >
                            <i class="bi bi-clipboard"></i> 复制所有邮箱
                          </button>
                        </div>
                        <div class="email-list-container">
                          <div class="list-group">
                            <div
                              v-for="(email, index) in extractedEmails"
                              :key="index"
                              class="list-group-item"
                            >
                              {% raw %}{{ email }}{% endraw %}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Alert Messages -->
                  <div
                    v-if="alertMessage"
                    class="alert mt-4"
                    :class="'alert-' + alertType"
                    role="alert"
                  >
                    <i
                      :class="'bi bi-' + (alertType === 'success' ? 'check-circle-fill' : 'exclamation-circle-fill')"
                    ></i>
                    <span v-text="alertMessage"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <footer class="mt-4 mb-5 text-center text-muted">
          <p>
            <small
              >免费转载需标注出处：B站-纸鸢花的花语，此工具仅供交流学习和技术分析，严禁用于任何商业牟利行为。</small
            >
            <br />
            <small
              ><a href="https://github.com/kiteyuan/Pikpak-Auto-Invitation"
                >项目开源地址</a
              ></small
            >
          </p>
        </footer>
      </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
